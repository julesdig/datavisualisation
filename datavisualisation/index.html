<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>D3.js Chart Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://d3js.org/d3.v6.js"></script>
</head>
<body>

<div class="container-fluid">
    <div class="d-flex justify-content-center mb-5"><h1>Titre</h1></div>
    <div class="text-center">
        <img src="Voiture.jpeg" class="img-fluid rounded"  width='1000 px' alt="...">
    </div>
    <div class="d-flex justify-content-center">
        <div class="card" style="width: 40rem; border:none;">
            <div id="my_dataviz"></div>
            <div class="card-body text-center">
                <h5 class="card-title">Autonomie</h5>
            </div>
        </div>
    </div>
    <div class="row m-4">
        <div class="d-flex justify-content-center">
            <div class="card" style="width: 18rem;">
<p>text</p>
            </div>
            <div class="card" style="width: 18rem;">
                <p>text</p>
            </div>

        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const data = {"name": "cars", "children": [{"name": "Aiways ", "children": [{"name": "SUV", "value": 335}]}, {"name": "Audi ", "children": [{"name": "SUV", "value": 410}, {"name": "Sedan", "value": 425}]}, {"name": "BMW ", "children": [{"name": "Hatchback", "value": 235}, {"name": "SUV", "value": 360}, {"name": "Sedan", "value": 450}]}, {"name": "Byton ", "children": [{"name": "SUV", "value": 400}]}, {"name": "CUPRA ", "children": [{"name": "Hatchback", "value": 425}]}, {"name": "Citroen ", "children": [{"name": "SUV", "value": 250}]}, {"name": "DS ", "children": [{"name": "SUV", "value": 250}]}, {"name": "Fiat ", "children": [{"name": "Cabrio", "value": 250}, {"name": "Hatchback", "value": 250}]}, {"name": "Ford ", "children": [{"name": "SUV", "value": 450}]}, {"name": "Honda ", "children": [{"name": "Hatchback", "value": 170}]}, {"name": "Hyundai ", "children": [{"name": "Liftback", "value": 250}, {"name": "SUV", "value": 400}]}, {"name": "Jaguar ", "children": [{"name": "SUV", "value": 365}]}, {"name": "Kia ", "children": [{"name": "SUV", "value": 370}]}, {"name": "Lexus ", "children": [{"name": "SUV", "value": 270}]}, {"name": "Lightyear ", "children": [{"name": "Liftback", "value": 575}]}, {"name": "Lucid ", "children": [{"name": "Sedan", "value": 610}]}, {"name": "MG ", "children": [{"name": "SUV", "value": 220}]}, {"name": "Mazda ", "children": [{"name": "SUV", "value": 180}]}, {"name": "Mercedes ", "children": [{"name": "SPV", "value": 330}, {"name": "SUV", "value": 370}]}, {"name": "Mini ", "children": [{"name": "Hatchback", "value": 185}]}, {"name": "Nissan ", "children": [{"name": "Hatchback", "value": 440}, {"name": "SPV", "value": 190}]}, {"name": "Opel ", "children": [{"name": "Hatchback", "value": 275}, {"name": "MPV", "value": 335}, {"name": "SUV", "value": 255}]}, {"name": "Peugeot ", "children": [{"name": "Hatchback", "value": 275}, {"name": "SUV", "value": 250}]}, {"name": "Polestar ", "children": [{"name": "Liftback", "value": 400}]}, {"name": "Porsche ", "children": [{"name": "Sedan", "value": 425}, {"name": "Station", "value": 385}]}, {"name": "Renault ", "children": [{"name": "Hatchback", "value": 315}, {"name": "SPV", "value": 160}]}, {"name": "SEAT ", "children": [{"name": "Hatchback", "value": 195}]}, {"name": "Skoda ", "children": [{"name": "Hatchback", "value": 195}, {"name": "SUV", "value": 420}]}, {"name": "Smart ", "children": [{"name": "Cabrio", "value": 95}, {"name": "Hatchback", "value": 100}]}, {"name": "Sono ", "children": [{"name": "Hatchback", "value": 225}]}, {"name": "Tesla ", "children": [{"name": "Cabrio", "value": 970}, {"name": "Liftback", "value": 515}, {"name": "Pickup", "value": 750}, {"name": "SUV", "value": 450}, {"name": "Sedan", "value": 450}]}, {"name": "Volkswagen ", "children": [{"name": "Hatchback", "value": 440}, {"name": "SUV", "value": 420}]}, {"name": "Volvo ", "children": [{"name": "SUV", "value": 375}]}]};
       _chart(d3, data);
        function _chart(d3, data) {
            console.log("data");
            // Specify the chart’s dimensions.
            const width = 928;
            const height = width;
            const radius = width / 6;
// Create the color scale.
            const color = d3.scaleOrdinal(d3.quantize(d3.interpolateRainbow, data.children.length + 1));

            // Compute the layout.
            const hierarchy = d3.hierarchy(data)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);
            const root = d3.partition()
                .size([2 * Math.PI, hierarchy.height + 1])
                (hierarchy);
            root.each(d => d.current = d);

            // Create the arc generator.
            const arc = d3.arc()
                .startAngle(d => d.x0)
                .endAngle(d => d.x1)
                .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                .padRadius(radius * 1.5)
                .innerRadius(d => d.y0 * radius)
                .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))

            // Create the SVG container.
            const svg = d3.create("svg")
                .attr("viewBox", [-width / 2, -height / 2, width, width])
                .style("font", "10px sans-serif");

            // Append the arcs.
            const path = svg.append("g")
                .selectAll("path")
                .data(root.descendants().slice(1))
                .join("path")
                .attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
                .attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)
                .attr("pointer-events", d => arcVisible(d.current) ? "auto" : "none")

                .attr("d", d => arc(d.current));

            // Make them clickable if they have children.
            path.filter(d => d.children)
                .style("cursor", "pointer")
                .on("click", clicked);

            const format = d3.format(",d");
            path.append("title")
                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`);

            const label = svg.append("g")
                .attr("pointer-events", "none")
                .attr("text-anchor", "middle")
                .style("user-select", "none")
                .selectAll("text")
                .data(root.descendants().slice(1))
                .join("text")
                .attr("dy", "0.35em")
                .attr("fill-opacity", d => +labelVisible(d.current))
                .attr("transform", d => labelTransform(d.current))
                .text(d => d.data.name);

            const parent = svg.append("circle")
                .datum(root)
                .attr("r", radius)
                .attr("fill", "none")
                .attr("pointer-events", "all")
                .on("click", clicked);

            // Handle zoom on click.
            function clicked(event, p) {
                parent.datum(p.parent || root);

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = svg.transition().duration(750);

                // Transition the data on all arcs, even the ones that aren’t visible,
                // so that if this transition is interrupted, entering arcs will start
                // the next transition from the desired position.
                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .filter(function(d) {
                        return +this.getAttribute("fill-opacity") || arcVisible(d.target);
                    })
                    .attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)
                    .attr("pointer-events", d => arcVisible(d.target) ? "auto" : "none")

                    .attrTween("d", d => () => arc(d.current));

                label.filter(function(d) {
                    return +this.getAttribute("fill-opacity") || labelVisible(d.target);
                }).transition(t)
                    .attr("fill-opacity", d => +labelVisible(d.target))
                    .attrTween("transform", d => () => labelTransform(d.current));
            }

            function arcVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
            }

            function labelVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
            }

            function labelTransform(d) {
                const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                const y = (d.y0 + d.y1) / 2 * radius;
                return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
            }

            // ... (Your existing _chart function)

            document.getElementById("my_dataviz").appendChild(svg.node());
        }
    });

</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
</body>
</html>
